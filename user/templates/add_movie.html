{% extends 'base.html' %}

{% block content %}

    <h1>Add a New Movie</h1>
    <div id="containerAdd">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}  
            <label id="texti" for="title">Title: </label>
            <input type="text" name="title" id="title" list="suggestions" required placeholder="Search movies..."><br>
            <datalist id="suggestions"></datalist>
                <label id="descriptionTexti" for="description">Description:</label>
            <textarea name="description" id="description" rows="5" required></textarea><br>
            <label id="texti" for="poster">Poster Image:</label>
            <input type="file" name="poster" id="poster" accept="image/*"><br>
            <label id="texti" for="available">Available:<br></label>
            <input type="checkbox" name="available" id="available" value="True"> Available for viewing<br><br>
                <button class="submitButton" type="submit">Add Movie</button>
            </form>
    </div>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
    document.getElementById('title').addEventListener('input', function() {
        var query = this.value;
        if (query.length > 2) {
            axios.get('{% url "user:movie_autocomplete" %}', {
                params: {
                    query: query
                }
            })
            .then(function(response) {
                let suggestions = document.getElementById('suggestions');
                suggestions.innerHTML = '';
                response.data.forEach(title => {
                    let option = document.createElement('option');
                    option.value = title;
                    suggestions.appendChild(option);
                });
            })
            .catch(function(error) {
                console.error('Error:', error);
            });
        }
    });
</script>

{% endblock %}
